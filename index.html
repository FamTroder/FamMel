<!--suppress XmlHighlighting -->
<html lang="en">
<head>
    <meta charset="UTF-8">
<!-- TODO sort out imports?-->
    <script src="scripts/main.js"></script>
    <script src="scripts/quotes.js"></script>
    <script src="scripts/animation.js"></script>
    <script src="scripts/settings.js"></script>
    <script src="scripts/images.js"></script>
    <script src="scripts/yourhome.js"></script>
    <script src="scripts/objects.js"></script>
    <script src="scripts/actions.js"></script>
    <script src="scripts/bladder.js"></script>
    <script src="scripts/yourbladder.js"></script>
    <script src="scripts/clothes.js"></script>
    <script src="scripts/herhome.js"></script>
    <script src="scripts/drive.js"></script>
    <script src="scripts/locations/driveAround.js"></script>
    <script src="scripts/locations/theBar.js"></script>
    <script src="scripts/locations/theatre.js"></script>
    <script src="scripts/locations/theMakeOut.js"></script>
    <script src="scripts/locations.js"></script>
    <script src="scripts/games/darts.js"></script>
    <script src="scripts/fuckHer.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <title>Melissa Explains it All</title>
</head>
<body>
<!--TODO fix text flicker when start is loaded with picture-->
<link rel="stylesheet" type="text/css" href="style.css">
<div class="fullscreen">
    <div id="backpack-cnt">
        <div id="backpackcontent">
            <span id="closebackpack">&times;</span>
            <p>This is your backpack</p>
            <div id="item-text">

            </div>
            <div class="btn-group" id="backpackitems">
            </div>
        </div>
    </div>
    <div id="titlebar">
        <div id="credits">Game Engine 3.2a by drw</div>
        <div id="version">VER 4.2: June 24, 2020</div>
    </div>
    <br>
    <hr>
    <br>
    <div id="gamescreen">
        <div id="picture">
            <pre id="thepic"></pre>
        </div>
        <div id="textsp">
            <p class="title">Melissa Explains it All </p>
            <p style="text-align: center">This game contains mature content.</p>
            <!--            TODO change class-->
            <ul id="choices" class="choices-start">
<!--                <li class="choices-items-start"><a href='javascript:go("start")'>Continue</a></li>-->
<!--                <li class="choices-items-start"><a href='javascript:go("under18")'>Leave</a></li>-->
<!--                <li class="choices-items-start"><a href='javascript:Object.keys(objects).forEach(key => objects[key].value = 2);'>All Items</a></li>-->
            </ul>
            <pre style="padding-top: 10vh;padding-left:30vw;"><br>  ((<br>  -))<br>  /\) <br> ( |)<br>   \ \<br>   _/ )<br>  //-/<br>  ||<br>  d/<br></pre>
        </div>
        <a href="javascript:backpack()"><img id="backpack" src="icons/backpack.png" alt="Picture of girl" class="pic"></a>
    </div>
    <div id="statsp">
        <table id="stats-bar">
            <tbody>
            <tr>
                <td>&nbsp;</td>
                <td class="stats-cells"><small>Money</small></td>
                <td class="stats-cells"><small>Attraction</small></td>
                <td class="stats-cells"><small>Shyness</small></td>
                <td class="stats-cells"><small>Tummy</small></td>
                <td class="stats-cells"><small>Her Bladder</small></td>
                <td class="stats-cells"><small>Time</small></td>
                <td class="stats-cells"><small>Your Tummy</small></td>
                <td class="stats-cells"><small>Your Bladder</small></td>
            </tr>
            <tr>
                <!--                TODO fix this-->
                <td>&nbsp;</td>
                <td id="mon" class="stats-cells-blue">$200</td>
                <td id="att" class="stats-cells-white">10</td>
                <td id="shy" class="stats-cells-blue">90</td>
                <td id="tum" class="stats-cells-white">92</td>
                <td id="blad" class="stats-cells-blue">308</td>
                <td id="time" class="stats-cells-white">7:02 PM</td>
                <td id="ytum" class="stats-cells-blue">190</td>
                <td id="yblad" class="stats-cells-white">510</td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<script>
    /*

   Since last release ( 3.0 )

    RECENT REQUESTS ( actual requests ):
1)  Different clothing for different girls
2)  More than 1 girl at the same time
3)  When she wets herself, starts losing slowly, a squirt, a wet patch, a bigger patch, then loses entirely.
4)  Player also has bladder & pee need.

    RECENT CHANGES:

1)  Ability to make a custom girl
2)  Elevator hijinx - she can wet herself, and sometimes
    somebody comes out of the elevator.
3)  New outfit: jeans and black tee - both tight.
4)  Records empty champagne bottle
5)  Bladder size reduces when she holds it too long.
6)  Enhanced debug mode
7)  Flirting with the lady bartender in the club -> jelousy
8)  Began modification for solo activities and started solo bargirl scene.
8A)  Somewhat Enhanced solo bargirl scene.
9)  Made wetting the bed a non-losing option.
10) Added possibility to take her keys or cellphone when you let her go pee.
11) Added lost keys functionality to apartment
12)  Massively Enhanced solo bargirl scene.

    STUFF TO FIX:

    STUFF TO ADD:

1) Bladder Buster night randomly available in the bar.  Bathroom
   continuously locked rather than just randomly locked.
2) She tries to pee in a glass under the table in the bar if she has to go bad.
3) You ask her to take a camera into the bathroom with her.
4) You can abandon the date:
    - You excuse yourself to go to the restroom?
    After which:
        - hole in the wall to see inside the ladies room with a line
        - pick up an escort
        - should there be a lady bartender?
5) You "find" objects of power:
    - magic bladder gun?
    - diuretic pills?
    - remote control?
6) More games - truth or dare?
7) She left her keys in your car...
8) Flesh out the stuff you see while you're driving
9) Solo Hotel:
   - Front office girl is stuck and has to pee
   - Room service girl brings & shares champagne
   - Escort in-call


=========================
FIXES BY OLRAST

3.2.1

* Setting custom girl bladder capacity works now
* When using a custom girl with JPG pictures, pictures of the girl she's based on are displayed

3.2.2

* Fixed image flicker

3.2.3

* Removed tracking code (injected by a hosting site?)

============================
CHANGES BY Forget_About_Me

4.0

*fixed some game-breaking bugs with rarer scenes
*General bug fixes
*changed the html so now the game is in the full browser screen instead of only part of it.
*You can now kiss and feel her up in the dark bar
*Added a make-out option to the hot tub
*Clothes now get reset when leaving a make-out session(beach and hot-tub)
*fixed some typos
*Added the option to be able to repeat actions during a make-out/sex session
*Added the option to have actions reset between make-out/sex sessions
*In the theatre you can now ask her which movie she wants to watch
*Tweaked the success of actions during the movie a bit.
*Implemented PlayerBladder - needs better scenes

=====================

4.1

*Added possibilities for you to pee when the bathroom is unavailable
*Tweaked how the bladders fill a tiny bit. Not noticeable for players.
*fixed a bug where you didn't lose control during the drinking game
*Slight code cleanup
*She no longer takes the vase/shot glass to the bathroom with her when you are in the car/outside
*At the end of the drinking game you no longer automatically go to the bathroom
*She no longer asks for the bar if you have already been there
*When you're alone she will no longer ask you to hold her purse
*You can now set a custom capacity for your bladder
*increased the amount of money you have, since you now also need to buy for yourself
*You can now only go to the bathroom if you actually need to go
*You can now pee in the tub
*You now can't have sex with her if she is still wearing bottoms
*You no longer can change the options mid-game
*Fixed a bug that caused a line to be said twice
*You no longer automatically lose attraction if you ask her to hold it and she's not desperate
*Started organizing the clutter that happens when you have a lot of items
*You can now drink with her
*You can ask her how she is doing when she's holding it for you
*Added an option to change how much money you have

==================

4.2

*Tweaked the chance of spurting instead of fully wetting
*Fixed a game breaking bug in the drinking game
*Changed the chance she'll hold it if you ask when she's desperate
*Code cleanup
*Fixed the bug were bladder-limits weren't updated when choosing a preset girl
*Fixed that you still drink soda even if you're tummy is full
*Fixed the bug where she only asks for the bar, all the time
*First start on splitting the code into multiple files
*Changed the way stats are handled to be a bit more elegant
*Replaced all deprecated code
*Changed lost attraction if you make her drink while desperate
*Fixed that the wrong dialogue appears when you lose control during the drinking game
*Changed end scenes for the drinking game
*You can now keep buying drinks in a row.

========
0.5.0

*Moving quotes to JSON
*Settings are now saved between sessions
*Fixed the loop with a certain end-scene of the drinking game
*Changed the way pictures are added
*Changed with how much cocktails increase max-tummy
*Tweaked chance of finding key to hopefully be a bit more favourable
*Fixed bug that reset the flirt counter when trying to leave
*Fixed preventpee being called if she doesn't have to go during pickup
*Fixed that you and her use the same counter for a locked bathroom
*Changed volume of water bottles and beer to 250ml to be slightly more realistic
*Added option to turn off playerBladder
*Added a backpack which works as an inventory
*Removed debug mode
*Added the option to always ask her to pee into something, without caring about her need
*Added a gas station
*Tweaked the insistent asking to pee:
    * WaitCounter now takes into account bladder size. With a minimum amount
    * WaitCounter is only ignored if she's genuinely within 2 ticks of wetting
*When selling panties you now get the option to buy more beer.
*Added more topics for talking in the bar.
*Added dart game
*There can now be a line for the bathroom in the theatre
*the statusbar now just flashes temporary when an attribute changes instead of until the next button is pressed
*The flashing of the statusbar now differentiates between positive(green) and negative(red) changed
*During the movie, the only time attraction checks are used are at the beginning and the end.
*Buying has been changed so you can now build up to 100 items at the same time, provided you have the money.
    *Stealing is unchanged for now as payment for stealing.
*/

    //TODO potentially clean up if statements with multiple locations
    //TODO fix replacing whole arrays if not needed

    // Debug Parameters
    let enableimages = 0; // 0 = Disable image loading
    let enableascii = 1; // 0 = Disable ascii art display
    let enablehide = 0; // 1 = Hide screen

    let showstats = 1; // 1 = Show her bladder state, etc.
    // Girl Selection Parameters
    let photolevel = 0; // 0 = clothed, 1 = costumed, 2 = to be naked, 3 = naked.


    let favoritemovie = "theurge";
    let suggestedloc = "thebar";

    let heroutfit = "jeans";  //  Her clothing choice for the date
                              //  Possible values: skirt, jeans

    const clubclosingtime = 7 * 60; // 2:00AM
    const theaterclosingtime = 3 * 60; // 10:00PM last showing
    const barclosingtime = 6 * 60; // 1:00AM

    let money = 200;
    let attraction = 10;
    let tummy = 100;
    let bladder = 300;
    let shyness = 90;

    let tumavg = tummy; // Average blood water level
    const tumdecay = 6; // Number of calculation cycles to average bladder filling

    let lastmoney = money;
    let lastattraction = attraction;
    let lastshyness = shyness;

    let hour = 7;
    let minute = 0;
    let meridian = "PM";
    const timespeed = 2;
    let thetime = 0;

    // Fucking Parameters, mostly to figure out what she still has on.
    let arousal = 0;
    let kisscounter = 0;
    let feelcounter = 0;
    let xskirt = 0;
    let xtop = 0;
    let xbra = 0;
    let xpanties = 0;
    let kneck = 0;
    let kthigh = 0;
    let kpussy = 0;
    let kbreast = 0;
    let tthigh = 0;
    let tpussy = 0;
    let tbreast = 0;
    let tass = 0;
    let fuckingnow = 0; // You are in the middle of fucking.
    let multiplemoves = 1;
    let rstmoves = 0; //Whether the sex moves reset after a make-out session
    //Formatting Parameters
    let slopen = 0; // Formatting : flags if string has been placed.
    let imageprev = "imgs/Laura/pixnorm.gif";  // Previous image
    const imagedesc = '"Picture of girl"';
    let imagename = imageprev;  // Actual picture.  Goes to default after 1 turn.
    let comma = 0; // used in formatting posessions.

    //Counter Parameters
    const maxkiss = 7; // maximum number of kisses that have effect.
    const maxfeel = 7; // maximum number of feel-ups that have effect

    const randmax = 5; // Maximum value of random counter
    let pstorycounter = 0;

    let posectr = 0; // keep track of which pose is next/last.
    const posemax = 5; // Maximum value of pose counter

    let outfitctr = 0; // keep track of the outfit being worn.
    const outfitmax = 5; // maximum count of outfits


    //  Location handling stack
    //  initialized at the start.
    const locstack = Array(); //The first element in the Array is the current location

    //  flags
    // Indicates new venue change
    let didintro = 0; // Flag for having done introduction
    let onphone = 0; // Flag for being on the phone with her
    let shopping = 0;// Flag for being in the shop
    let seenmovie = 0; // Flag for having seen a movie already
    let beenbar = 0;  //  Been to the bar already
    let beenclub = 0; // Been to the club already
    let beenmakeout = 0; // Seen a movie already
    let flirtedflag = 0; // Actually a counter.  Keeps track of flirting.
    const maxflirts = 2; // Maximum flirt points per venue
    //TODO lockedflags  should probably be renamed counters
    let rrlockedflag = 0; // Restroom was locked last time she went
    let yrrlockedflag = 0;
    let askedswim = 0; // She's asked about a swim
    let wetthecar = 0; // Seat of the car is wet
    let shespurted = 0; // She only spurted
    let brokeice = 0; // She's previously brought up that she needs to pee
    let sawherpee = 0; // You've seen her pee
    let haveherpurse = 0; // You're holding her purse
    let late = 0; //You are late to pick her up

    let bartopic = 0; // Topics of discussion at the bar.
    let noflirtflag = 0; // Suppress flirty options

    let externalflirt = 0; // You flirted with somebody else

    // Girl stats(Counter and Flags)
    let owedfavor = 0; // she owes you a favor
    let pantycolor = "black";
    let flirtcounter = 0; // time since last flirt ( counts by 2 )
    let wetlegs = 0; // her legs are wet
    let wetherpanties = 0; // did she ever wet herself?
    let prepeed = 0; // did she pee before you picked her up
    let champagnecounter = 0; // Number of glasses of champagne served.
    let drankChamp = 0; // Time since last champagne glass was drunk.
    let gottagoflag = 0; // has she just asked to use the restroom
    let showedneed = 0; // has she just visually displayed her need
    let changevenueflag = 0; // you are changing venue - makes her easily ask to pee.
    let moviecounter = 0; // Keep track of location in movie
    let moviechoice; //  Which movie are we showing
    let askedfavourite = 0; //asked her which movie to watch

    let askholditcounter = 0; // How many times have you asked her to hold it.
    let waitcounter = 0; // how long ago did she ask to pee?
                         //Reset positive when you ask her.

    let nowpeeing = 0; // She is currently peeing
    let ynowpeeing = 0; // You're currently peeing
    let checkedherout = 0; // Flags that you just checked her out.

    let walkcounter = 0; // How far have you walked
    let elevatorwaitcounter = 0;



    /*
  -----------------------------------------------------------------
  GAME TEXT

   Most, but not all of the text in the game is stored in arrays.
   Note that all text with the girl's name in it has to be redefined
   later ( options dialog ) if the name of the girl is changed.
  -----------------------------------------------------------------
*/

    //
    //
    //  First set all the clothing related variables we're going to
    //  have as globals...  This is so she can have different outfits
    //  in normal life.  It's a lot of work, isn't it?
    //
    //

    let feelher;
    let feelres;
    let feelpee;
    let posenorm;
    let poseoutfit;
    let donoutfit;
    let donemer;
    let fillchampok;
    let stareather_laura;
    let stareather_karen;
    let stareather_jennifer;
    let stareather_melissa;
    let stareather;
    let dryquote;
    let peeshotquote;
    let peetowelquote;
    let peeoutsidequote;
    let peeoutsidequotebare;
    let peeoutsidebquote;
    let peeoutsidebquotebare;
    let wetherselfquote;
    let firstmtgquote;
    let firstmtgtightquote;
    let firstmtgtightquotebare;
    let soakedseatquote;
    let peeprepquotebare;
    let undressquote;
    let undressquoteemer;
    let ptogetherquote;
    let ptogetherquotebare;
    let ptogetheroutquote;
    let ptogetheroutquotebare;
    let finishtogethroutquote;
    let finishtogetheroutquotebare;
    let ptogetherdumpquote;
    let ptogetherdumpquotebare;
    let finishtogetherdumpquote;
    let finishtogetherdumpquotebare;

    let sextakeoffskirt;
    let sextakeoffblouse;

    let sextouchthighquote;
    let sextouchassquote;
    let sextouchpussyquote;
    let sexkissthighquote;
    let sexkisspussyquote;

    let sextoskirtquoteemer;
    let sextoskirtquote;
    let sextoskirtquotebare;
    let sextopantiesquote;
    let swimstripquote;
    let swimstripquotebare;
    let swimstripquotepanties;

    //
    //  She loses control
    //
    let wetquote = ["Suddenly, " + girlname + " squeals and then gasps!",
        "Suddenly, " + girlname + " freezes in place and her face turns bright red.",
        girlname + " gasps and grabs at her pussy.",
        girlname + " squeals and doubles over.",
        girlname + " suddenly gasps and her face turns red.",
        girlname + " suddenly shudders and her face turns red."];
    /*

  -----------------------------------------------------------------

  DISPLAY MECHANICS

  Stuff that writes to the screen.

  -----------------------------------------------------------------

*/
    // Cache a statement
    //    t - the text to display.
    function s(t) {
        document.getElementById('textsp').innerHTML += t + "<p>";
    }


    //TODO this probably can be done more efficient
    function goback() {
        if (locstack[0] === "beachsex") {
            s("You both slowly get up from the sand and dust yourselves off.");
            s("You put yourself back together and help " + girlname + " make herself presentable.");
            showneed();
            resetclothes();
            if (rstmoves === 1) {
                resetmoves();
            }
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "thebeach") {
            s("You and " + girlname + " dust yourselves off and hike back up to the road.");
            showneed();
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "photogame") {
            if (photolevel === 3) {
                if (bladder > blademer)
                    s("Desperate to get to a restroom, but also somewhat shy,");
                s(girlname + " quickly puts her clothes back on and hops off the stage.");
            } else if (photolevel === 3) {
                if (bladder > blademer)
                    s("Desperate to get to a restroom, but also running somewhat on autopilot,");
                s(girlname + " quickly changes back into her clothes and hops off the stage.");
            } else {
                s(girlname + " hops down off the stage.");
            }
            showneed();
            poploc();
            c("indepee", "Continue... ");
        } else if (locstack[0] === "dodance") {
            s("You pull " + girlname + " off the dancefloor.");
            showneed();
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "thewalk") {
            s("You take " + girlname + "'s hand and hoof it quickly back to your parked car.");
            showneed();
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "theyard") {
            s("You stealthily creep back out of the gate, with " + girlname + " in tow.");
            showneed();
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "ptogether") {
            s("You quickly compose yourselves and head back out to the club, but first...");
            poploc();
            kissher();
        } else if (locstack[0] === "pgirlsroom") {
            s("You quickly compose yourselves guiltily sneak back out of the ladies room, but first...");
            poploc();
            kissher();
        } else if (locstack[0] === "pnorestroom") {
            s(girlname + " sighs in relief, and seems very aroused.");
            s(girltalk + "I feel <i>so</i> naughty!");
            poploc();
            kissher();
        } else if (locstack[0] === "thehottub") {
            s("You take " + girlname + "'s hand and help her out of the hot tub, admiring the view in the dim starlight.");
            s("You can't help staring as she dries off as best she can and dresses beside you in the warm evening air.");
            showneed();
            poploc();
            c(locstack[0], "Continue... ");
        } else if (locstack[0] === "tubsex") {
            s("You both sit there for a few seconds, trying to catch your breath.");
            c(locstack[0], "Continue...");
        } else {
            poploc();
            eval(locstack[0] + "()");
        }

    }

    /*

  -----------------------------------------------------------------

  Common Tasks

  Commonly used functions for common situations.

  -----------------------------------------------------------------

*/
    function champagnenow() {
        if (champagnecounter > 5) {
            s("Sadly, the bottle of champagne is empty.");
        } else {
            s("You suggest having some champagne.");
            if (champagnecounter === 0) {
                s("She smiles and goes into the kitchen to get some glasses.");
            }
            displayneed();
            if (bladder < blademer) {
                s(fillchampok[randcounter]);
                champagnecounter++;
                s("You toast and enjoy the champagne together.");
            } else if (bladder < bladlose) {
                s(girltalk + wonderwhy[randcounter]);
                incrandom();
                displaygottavoc();
                s(fillchamp[randcounter]);
                incrandom();
                champagnecounter++;
                s("She drinks the champagne with you after a hurried toast.");
            } else {
                s(girltalk + cantdo[randcounter]);
                incrandom();
                s(girltalk + "I can't even <i>think</i> about champagne");
                displaygottavoc();
                s(fillchampbad[randcounter]);
                incrandom();
                champagnecounter = 6;
                s("She tosses back the champagne quickly, dropping the glass onto the floor.");
            }
            tummy += 50;
            yourtummy += 50;
        }
        c(locstack[0], "Continue...");
    }



    function giveroses() {
        if (bladder < blademer) {
            s(girltalk + "Thanks! They're beautiful.");
            attraction += 7;
        } else {
            s(girltalk + "Thanks for the flowers, but I've really got to go.");
            s("She takes the roses and holds them against her belly.");
            attraction += 2;
            waitcounter += 2;
        }
        roses -= 1;
        c(locstack[0], "Continue...");
    }

    /*

  -----------------------------------------------------------------

  STORY PARTS

  Separate parts of the story, in more or less order.

  -----------------------------------------------------------------

*/


    //TODO no pay and move on if you have no money
    function buydrink() {
        if (money >= 9) {
            s(bargirldesc[randcounter]);
            incrandom();
            s("You buy a cocktail for $9.00.");
            cocktail += 1;
            money -= 9;
            s("<b>BARTENDER:</b> " + bargirlquotes[randcounter]);
            incrandom();
        } else s("You don't have enough money!");
        c("flirtbargirl", "Flirt with the bar girl.");
        c("buydrink", "Buy another one.");
        if (money >= 9) c(locstack[0], "Pay and move on...");
        else c(locstack[0], "Continue...");
    }

    function flirtbargirl() {
        s("<b>YOU:</b>" + bargirlflirt[randcounter]);
        s(bargirldesc[randcounter]);
        s("<b>BARTENDER:</b> " + bargirlresp[randcounter]);
        incrandom();
        s(girlname + " seems to be glaring at you.");
        externalflirt++;
        c(locstack[0], "Continue...");
    }


    function breakclub() {
        s("You try the door with your key...");
        if (bladder > blademer) {
            s(girltalk + sayhero[randcounter]);
            attraction += 3;
        }
        displayneed();
        displayyourneed();
        c("darkclub", "Continue...");
    }

    function reclub() {
        clubkey = 0;
        pushloc("theclub");
        theclub();
    }

    function darkclub() {
        if (locstack[0] !== "darkclub") {
            s("You and " + girlname + " enter the nightclub.  It's dark, silent and deserted.");
            pushloc("darkclub");
        } else {
            s("You are with " + girlname + " in the closed nightclub.");
        }

        showneed();
        displayyourneed();
        if (bladder > bladlose) wetherself();
        else if (yourbladder > yourbladlose) wetyourself();
        else if (gottagoflag > 0) preventpee();
        else {
            standobjs();
            if (!checkedherout) c("checkherout", "Check her out.");
            c("youpee", "Go to the bathroom.");
            c("leavehm", "Leave the club.");
        }
    }


    function theclub() {
        if (beenclub && locstack[0] === "driveout" && thetime < clubclosingtime) {
            s(girlname + " giggles: But we've already been to the club, silly!");
            if (clubkey > 0)
                c("reclub", "But I found this key I have to return!");
            c(locstack[0], "Continue...");
        } else {
            if ((thetime < clubclosingtime) || locstack[0] === "theclub") {
                if (locstack[0] !== "theclub" && locstack[0] !== "dodance") {
                    s("You and " + girlname + " enter the Night Club.");
                    pushloc("theclub");
                } else {
                    s("You are with " + girlname + " in the Night Club.");
                    if (randomchoice(3)) noteholding();
                    else if (randomchoice(5)) interpbladder();
                }

                beenclub = 1;
                showneed();
                displayyourneed();
                if (bladder > bladlose) wetherself();
                else if (yourbladder > yourbladlose) wetyourself();
                else {
                    if (gottagoflag > 0) {
                        preventpee();
                    } else {
                        c("buydrink", "Buy a drink.");
                        c("godance", "Ask her to dance.");
                        if (clubkey < 1) c("lookaround", "Look around.");
                        standobjs();
                        if (yourbladder > yourbladurge)
                            c("youpee", "Go to the bathroom");
                    }
                    c("leavehm", "Leave the club.");
                }
            } else itsclosed("theclub");
        }
    }

    function godance() {
        pushloc("dodance");
        changevenueflag = 1;
        showneed();
        displayyourneed();
        if (gottagoflag > 0) {
            c("holdit", "Ask her to hold it.");
            c("allowpee", "Let her go.");
        } else {
            s(girltalk + "Okay.  Let's dance.");
            s("You head out to the dancefloor to cut up the rug.");
            c(locstack[0], "Continue...");
        }
    }

    function dodance() {
        pushloc("dodance");
        s("You are dancing with " + girlname + " in your arms.");
        showneed();
        displayyourneed();
        if (randomchoice(3)) noteholding();
        else if (randomchoice(5)) interpbladder();

        if (bladder > bladlose) wetherself();
        else if (yourbladder > yourbladlose) wetyourself();
        else {
            if (gottagoflag > 0) {
                preventpee();
            } else {
                c(locstack[0], "Keep Dancing.");
                c("kissher", "Kiss her.");
                c("feelup", "Feel her up.");
                standobjs();
                if (yourbladder > yourbladurge)
                    c("youpee", "Go to the bathroom.");
            }
            c("goback", "Leave the dancefloor.");
        }
    }


    function pgirlsroom() {
        if (locstack[0] === "pgirlsroom") {
            poploc();
            eval(locstack[0] + "()");
        } else {
            pushloc("pgirlsroom");
            s("<b>YOU:</b> Can I watch?  It would be <u>so</u> sexy!");
            if (attraction >= pwatchthreshold) {
                displayneed();
                s(girltalk + "Really?  Well.... okay.  I guess there's nobody around.");
                s("She grabs you by the hand and heads for the ladies room.");
                displayneed();
                c("pgirlsroom2", "Follow her...");
                c("indepee", "Change your mind...");
            } else {
                s(girltalk + "I don't think so, buddy.");
                indepee();
            }
        }
    }

    function pgirlsroom2() {
        s("She looks right, looks left, and peeks in the door before quickly pulling you into a very cramped stall.");
        if (bladder < bladlose - 10) bladder = bladlose - 10;
        displayneed();
        s("The sight of the toilet seems to have increased her urgency.");
        c("ptogether3", "Continue...");
    }

    function pphotogame() {
        s("<b>YOU:</b> I know you really need to go, but can I take just a couple snapshots first?");
        displayneed();
        s(girltalk + "What <u>kind</u> of pictures?");
        c("photogame2", "Just a couple snapshots of you up on the stage there.");
        c("photogame2c", "How about a few costume pics?");
        c("photogame2n", "Well - nobody's around, so I'd really love it if you would do a few nudes.");
    }

    function photogame2() {
        if (attraction >= photogamethreshold) {
            displayneed();
            s(girltalk + "Okay.  But can I please go pee first?");
            displayneed();
            photolevel = 0;
            c("photogame", "I'd really like it if you'd wait...");
            c("indepee", "Alright - go ahead and pee.");
        } else {
            s(girltalk + "No way, dude.  I'm outta here.");
            indepee();
        }
    }

    function photogame2c() {
        if (attraction >= photogamecthreshold) {
            displayneed();
            s(girltalk + "Well, okay.  It would be neat to play dressup.  But can I please go pee first?");
            displayneed();
            photolevel = 1;
            c("photogame", "I'd really like it if you'd wait...");
            c("indepee", "Alright - go ahead and pee first.");
        } else {
            s(girltalk + "No way, dude.  I'm outta here.");
            indepee();
        }
    }

    function photogame2n() {
        if (attraction >= photogamenthreshold) {
            displayneed();
            s(girltalk + "That's naughty.  Very naughty.  But can I please go pee first?");
            displayneed();
            photolevel = 2;
            c("photogame", "I'd really like it if you'd wait...");
            c("indepee", "Alright - go ahead and pee first.");
        } else {
            s(girltalk + "No way, dude.  I'm outta here.");
            indepee();
        }
    }

    //TODO show your need
    //TODO fix wetherself when naked
    //TODO not running to the bathroom if she wet herself
    function photogame() {
        if (locstack[0] !== "photogame") {
            pushloc("photogame");
            displayholdquip();
            posectr = 0;
            askholditcounter++;
            s("<b>YOU:</b> Thanks.  You're very sexy.");
            s("You motion " + girlname + " up onto the nightclub stage.");
            s("She carefully ascends the stairs, and you find a switch that turns on some stage lights.");
        } else {
            s("You're taking snapshots of " + girlname + " up on the nightclub stage.");
            if (photolevel === 3) s("She's completely nude.");
            if (photolevel === 1) s("She's wearing " + poseoutfit[outfitctr] + ".");
            if (bladder > blademer) {
                interpbladder();
                noteholding();
            }
        }
        showneed();
        if (bladder > bladlose) wetherself();
        else if (yourbladder > yourbladlose) wetyourself();
        else {
            if (posectr <= posemax) c("photopose", "Ask her to pose.");
            if (photolevel === 1 && outfitctr < outfitmax) c("photochange", "Ask her to change.");
            if (photolevel === 2) c("photonude", "Ask her to disrobe.");
            c("goback", "Photo session is over...");
        }
    }

    function photopose() {
        s("<b>YOU:</b> How about striking a pose?");
        if (photolevel === 3)
            s(girlname + " " + posenude[posectr]);
        else
            s(girlname + " " + posenorm[posectr]);
        posectr++;
        if (bladder > blademer) {
            s(poseemer[randcounter]);
            incrandom();
        }
        c(locstack[0], "Take a photo...");
    }

    function photochange() {
        s("<b>YOU:</b> How about changing into a costume?");
        if (bladder > blademer) {
            s(girlname + " is almost doubled over as she takes little baby steps back to the closet and returns with a " + poseoutfit[outfitctr]);
            s(donemer[outfitctr]);
        } else {
            s(girlname + " walks back to the closet and returns with a" + poseoutfit[outfitctr]);
            s(donoutfit[outfitctr]);
        }
        outfitctr++;
        c(locstack[0], "Continue...");
    }

    function photonude() {
        s("<b>YOU:</b> Okay - so you can take off your clothes.");
        if (bladder > blademer) {
            s(girlname + undressquoteemer);
            s("<i>You can see her face filled with a look of concentration as she waits for an opportune moment to continue.</i>");
            s("She then shyly unclasps her bra, revealing her breasts briefly before turning her back to you.  Her thighs are rubbing together.");
            if (pantycolor === "none") {
                s("She quickly crosses her legs and squeezes tightly - she was not wearing any panties.");
            } else {
                s("She hesitates and looks to you for confirmation before spreading her legs slightly, giving her pussy a firm press, and quickly slipping her panties off then tightly crossing her legs.");
            }
        } else {
            s(girlname + undressquote);
            if (pantycolor === "none") {
                s("She's not wearing any panties.");
            } else {
                s("She hesitates and looks to you for confirmation before slipping her panties off and placing them on the floor next to her.");
            }
        }
        s("She's standing on stage completely nude.");
        incrandom();
        photolevel = 3;
        c(locstack[0], "Continue...");
    }

    //TODO option for you to pee as well
    function ptogether() {
        if (locstack[0] === "ptogether") {
            poploc();
            eval(locstack[0] + "()");
        } else {
            pushloc("ptogether");
            s("<b>YOU:</b> Don't go and leave me alone!");
            if (attraction >= ptogetherthreshold) {
                displayneed();
                s(girltalk + "Really?  You want to come with me?");
                s("She grabs you by the hand and heads for the back of the club.");
                displayneed();
                c("ptogether2", "Follow her...");
                c("indepee", "Change your mind...");
            } else {
                s(girltalk + "You're a big boy.  You can take care of yourself.");
                indepee();
            }
        }
    }

    //TODO option to make out
    function ptogether2() {
        s(girlname + " leads you back to the restrooms.");

        if (!randomchoice(rrlockedthresh)) {
            s("She looks right, looks left, and peeks in the door before quickly pulling you into a very cramped stall.");
            if (bladder < bladlose - 10) bladder = bladlose - 10;
            displayneed();
            s("The sight of the toilet seems to have increased her urgency.");
            c("ptogether3", "Continue...");
        } else {
            s("There's a long line for the womens restrooms.  You notice they're mostly young, dressed to the nines, and in various stages of extreme urinary urgency.  Your daydreams are interrupted quickly.");
            s(girlname + " squeezes your hand: I can't hold it!  What are we gonna do?");
            c("ptogether4", "Invite her into the mens room.");
            c("ptogether5", "Take her out the nearby back door.");
            c("ptogether6", "Stand around looking dumb.");
        }
    }

    function ptogether3() {
        if (pantycolor !== "none")
            s(girlname + ptogetherquote);
        else
            s(girlname + ptogetherquotebare);
        s("You try not to stare too much as the torrent cascades from between her thighs.  You hear the violent hissing and splashing of her pee, and the scent fills the tiny cubicle.  You want to touch her so badly.");
        flushdrank();
        sawherpee = 1;
        c("ptogether3d", "Feel the stream.");
        c("ptogether3c", "Kiss her thighs.");
        c("ptogether3b", "You're too shy.");
    }

    function ptogether3b() {
        s("As the torrent subsides, you offer her some tissue.");
        s(girltalk + "Thanks - I've never had to go so bad in my life!");
        s("<i>She seems relaxed, radiant ... and aroused.</i>");
        c("goback", "Continue...");
    }

    function ptogether3c() {
        s("You lay your head in her lap, the warmth of her thighs on your cheek.");
        s("The hissing is louder down there, and you feel the small droplets of her pee spray landing on your upper lips.");
        s("You can sense the heat from the stream, and the smell of her is overpowering.");
        c("ptogether3b", "Continue...");
    }

    function ptogether3d() {
        s("You caress her, running your hand down her back and along the line of her butt crack.");
        s("Her crack is warm and soft, and as your fingers reach the edge of her pussy lips, you feel small droplets from the urine stream wetting your hand.");
        s("You carefully put just one finger into the edge of her stream - it feels hot and wet.");
        c("ptogether3b", "Continue...");
    }


    // You take her into the mens room
    function ptogether4() {
        s("<b>YOU:</b> Quick!  In here!");
        s("You pull her across the hall towards the men's room.");
        s(girltalk + "But I can't go in there!");
        c("ptogether4b", "I'm a guy, and I'm giving you permission!");
        c(locstack[0], "Okay, then I guess you'll just have to hold it.");
    }

    function ptogether4b() {
        s("She follows you into the mens room, and you carefully avoid any eye contact with the two dudes using the urinals.");
        displayneed();
        s("You find a reasonably clean stall and pull her in with you.");
        c("ptogether3", "Continue...");
    }

    // You take her out back
    function ptogether5() {
        s("<b>YOU:</b> Quick!  In here!");
        s("You pull her towards the back door at the end of the hall.");
        s(girltalk + "Where are we going?");
        s("<b>YOU:</b> I know a place!");
        displayneed();
        s("You emerge together into a poorly lit parking lot.");
        c("ptogether5a", "Tell " + girlname + " to pee behind the dumpster.");
        c("ptogether5b", "Tell " + girlname + " you'll help her.");
    }

    function ptogether5a() {
        s("<b>YOU:</b>  You can go behind that dumpster over there!");
        s(girltalk + "<b>This</b> is your solution???");
        displayneed();
        s("You can see the struggle in her eyes as she makes up her mind what to do.");
        s(girltalk + "Can you hold me so I don't fall over?");
        c("ptogether5a2", "Okay...");
        c(locstack[0], "Nevermind - let's go back inside.");
    }

    function ptogether5a2() {
        s("You don't have to be asked twice.");
        s("You take her hand and lead her behind the dumpster.  She seems nervous.");
        displayneed();
        if (pantycolor !== "none") s(ptogetheroutquote);
        else s(ptogetheroutquotebare);
        s("You steady her and the stream starts immediately, first as an incoherent spray which slightly wets her shoes, and quickly building into a powerful stream.");
        s("By the time she finally cuts it off, the pee has pooled into a pond which is seeping under the dumpster.");
        if (pantycolor !== "none")
            s(finishtogethroutquote);
        else
            s(finishtogetheroutquotebare);
        flushdrank();
        sawherpee = 1;
        c("goback", "Continue...");
    }

    function ptogether5b() {
        s("<b>YOU:</b>  Here!  I'll help you.");
        s("You push her up against the wall, in the shadows a little ways from the door.");
        s(girltalk + "I can't...");
        if (pantycolor !== "none") {
            s(ptogetherdumpquote);
            s("Her pussy is warm and pulsing underneath the thin fabric as she struggles to control her bladder.");
            s("You pull the gusset aside and spread her lips with your fingers.");
        } else {
            s(ptogetherdumpquotebare);
            s("Her pussy is warm and pulsing aginst your hand as she struggles to control her bladder.");
            s("You carefully spread her lips between your fingers.");
        }
        c("ptogether5c", "Continue...");
    }

    function ptogether5c() {
        s("<b>YOU:</b>  Go.  Let it all out.");
        s("She protests, but not too strongly, and you feel her pussy tense just as the flow starts, running between your fingers and slightly wetting them before spattering onto the ground in front.");
        if (pantycolor !== "none")
            s(finishtogetherdumpquote);
        else
            s(finishtogetherdumpquotebare);
        s("She gives you a long, hard kiss before you head back inside together.");
        flushdrank();
        sawherpee = 1;
        c("goback", "Continue...");
    }

    // You stand around looking dumb.
    function ptogether6() {
        s("<b>YOU:</b> Duhhhhh...");
        displayneed();
        s("She stamps her foot in impatience.");
        s(girltalk + "You're no help!");
        s("You head back to the dance floor together.");
        c(locstack[0], "Continue...");
    }



    //TODO put flag in proper place
    let floorcounter = 0;
    function theelevator() {
        if (locstack[0] !== "theelevator") {
            pushloc("theelevator");
            s("You take " + girlname + " by the hand and go to wait in front of the elevator.");
            displayneed();
            displayyourneed();
            //TODO put flag in proper place
            elevatorwaitcounter = 0;
            c(locstack[0], "Continue...");
        } else {
            if (floorcounter === 0) {
                if (randomchoice(3)) {
                    if (elevatorwaitcounter > 2 && bladder > blademer) {
                        s("The elevator finally appears, and " + girlname + " rushes to enter as the door opens.  She suddenly steps back and stands still, trembling with the effort to conceal her desperation, as a pretty woman walks out.");
                        s(girlname + " lunges into the elevator and mashes the 3rd floor button with one hand while openly holding herself with the other.");
                    } else {
                        s("The elevator appears, so you step inside with " + girlname + " and hit the button for the 3rd floor.");
                    }
                } else {
                    s("The elevator has not yet arrived.");
                    s("You wait patiently with " + girlname + ".");
                    floorcounter = -1;
                    elevatorwaitcounter++;
                }
            } else if (floorcounter === 3) {
                s("The elevator finally reaches the 3rd floor.");
                s("You and " + girlname + " walk across the hall to the door of her apartment.");
                if (bladder > blademer && !herkeys)
                    s(girltalk + "Good thing I haven't lost my keys, huh?");
            } else {
                s("You're in the elevator with " + girlname + ".");
                noteholding();
            }
            showneed();
            if (floorcounter >= 3) {
                poploc();
            } else {
                floorcounter += 1;
            }
            if (bladder > bladlose) wetherself();
            else if (yourbladder > yourbladlose) wetyourself();
            else c(locstack[0], "Continue...");
        }
    }

    function givekeys() {
        herkeys = 0;
        s("You pull her keys from your pocket.");
        if (bladder >= blademer) {
            displayneed();
            s(girlname + " grabs the keys and opens the door.");
            c(locstack[0], "Continue...");
        } else {
            s(girltalk + " Where'd you get those?");
            c("keynevermind", "Ummm.....");
            c("keynevermind", "Errr.....");
            c("keynevermind", "Duhhh....");
        }
    }

    function keynevermind() {
        s(girltalk + " Oh, never mind.  Want to come in?");
        s("She opens the door.");
        c(locstack[0], "Continue...");
    }

    function lookforkeys() {
        s(girlname + " offers you her purse.");
        showneed();
        s("You palm the keys in your pocket, take her purse and rummage through it.");
        herkeys = 0;
        c("lookforkeys", "Haven't found anything yet.");
        c(locstack[0], "Found them!");
    }

    //TODO offer beer
    function thehome() {
        if (locstack[0] !== "thehome") {
            kisscounter = 0;
            feelcounter = 0;
            pushloc("thehome");
            s("You and " + girlname + " arrive at her place.");
            s("It's a 3rd floor apartment in a nice complex.");

            if (attraction > 100 && (beenbar || seenmovie) && beenclub && beenmakeout) {
                showneed();
                displayyourneed();
                s("She invites you to come up for a drink...");
                c("theelevator", "Go up with her.");
                c("gameover", "Say goodnight.");
            } else {
                s(girltalk + "Good Night...  see you soon?");
                locstack[0] = "gameover";
                c("gameover", "Continue...");
            }
        } else if (herkeys) {
            s(girlname + " searches through her purse for her keys.");
            displayneed();
            voccurse();
            s(girltalk + "I can't find my keys!");
            showneed();
            displayyourneed();
            c("givekeys", "Offer her her keys.");
            c("lookforkeys", "Offer to look for her keys.");
        } else {
            s("You are with " + girlname + " at her home.");

            if (kisscounter > maxkiss) {
                s(girlname + " suddenly pulls away from you and sits straight up.");
                s(girltalk + "You know, this just isn't working out.");
                s(girltalk + "I'm afraid we're going to have to call it a night.");
                c("gameover", "Continue...");
            } else {
                displaygottavoc();
                displayneed();
                displayyourneed();
                //TODO figure out what the hell this is
                if (champagnecounter > 5) {
                    if (bladder > bladlose)
                        s(girlname + " gasps: I'm going ... bathroom");
                    else
                        s("She invites you to come back to her bedroom.");
                    c("thebedroom", "Follow her closely to her bedroom.");
                    c("gameover", "Say goodnight.");
                } else {
                    if (gottagoflag) {
                        c("allowpee", "Tell her she should go and pee.");
                    }
                    c("youpee", "Ask if you can use her bathroom.");
                    c("kissher", "Kiss her on the lips.");
                    if (champagne > 0) {
                        c("champagnenow", "Offer her champagne.");
                    }
                    if (soda > 0) {
                        c("sodanow", "Offer her soda.");
                    }
                    c("gameover", "Say goodnight.");
                }
            }
        }
    }

    function thebedroom() {
        pushloc("thebedroom");
        if (locstack[0] !== "thebedroom") {
            s("You follow her closely back to her bedroom.");
            locstack[0] = "thebedroom";
            if (bladder > bladlose)
                s("She presses her crotch into the bedpost.");
            else
                s("She looks at you romantically with a cute little smile.");
        } else {
            s("You are with " + girlname + " in her bedroom.");
        }
        showneed();
        displayyourneed();
        if (gottagoflag) {
            c("allowpee", "Tell her she can go and pee.");
        }
        if (gottagoflag) {
            c("holdit", "Ask her to hold it.");
        }
        c("thebed", "Kiss her.");
        c("gameover", "Say goodnight.");
    }


    function gameover() {
        document.getElementById('textsp').innerHTML += "<p class='title'>Game Over, Dude! </p>"
            + "<p style='text-align: center; padding-right: 10%; font-style: italic'>You struck out</p>";
        s("<br>&nbsp;<br>&nbsp;");
        s("<br>&nbsp;<br>&nbsp;");
        s("<br>&nbsp;<br>&nbsp;");
        s("<div style='text-align:right'><i>Hit Reload to start over...</i></div>");
    }

    //Basically you got her into bed but not desperate
    function gameSex(){

    }

    function gamewet() {
        document.getElementById('textsp').innerHTML += "<p class='title'>Woot! </p>"
            + "<p style='text-align: center; padding-right: 10%; font-style: italic'>you took her to bed while she was bursting</p>"
            + "<p style='text-align: center; padding-right: 10%; font-style: italic'>and she held it for you until she wet the bed.</p>";
        s("<br>&nbsp;<br>&nbsp;");
        s("Final Stats:");
        s("Time since last pee:" + timeheld + " minutes");
        s("Bladder contained:" + bladder + " ml");
        s("<br>&nbsp;<br>&nbsp;");
        s("<div style='text-align:right'><i>Hit Reload to start over...</i></div>");
    }

    function gamewon() {
        document.getElementById('textsp').innerHTML += "<p class='title'>You Won!! </p>"
            + "<p style='text-align: center; padding-right: 10%; font-style: italic'>you took her to bed while she was bursting.</p>";
        s("<br>&nbsp;<br>&nbsp;");
        s("Final Stats:");
        s("Time since last pee:" + timeheld + " minutes");
        s("Bladder contained:" + bladder + " ml");
        s("<br>&nbsp;<br>&nbsp;");
        s("<div style='text-align:right'><i>Hit Reload to start over...</i></div>");
    }

    function startChoices(){
        const listenerList = [
            [["start", "Play"], "start"],
            [["under18", "Leave"], "leave"],
            [[function () {
                Object.keys(objects).forEach(key => objects[key].value = 2);
                go("start");
            }, "All Items (starts the game with all items)"], "allItems"]
        ];
        let html = "";
        listenerList.forEach(item => html += cListenerString(item[0], item[1]));
        document.getElementById("choices").innerHTML = html;
        listenerList.forEach(item => {
            document.getElementById(item[1]).classList.add("choices-items-start");
        })
        addListenersList(listenerList);
    }

    startChoices();

</script>
</body>
</html>
